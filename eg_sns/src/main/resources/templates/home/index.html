<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">

<!-- ======= Head ======= -->
<div th:replace="~{common/shoulder_fragment::head(title = 'SNSサイト - Home')}"></div>

<head>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

<body>

	<!-- ======= Header ======= -->
	<div th:replace="~{common/shoulder_fragment::header}"></div>

	<!-- ======= Sidebar ======= -->
	<div th:replace="~{common/shoulder_fragment::sidebar}"></div>

	<main id="main" class="main">

		<div class="pagetitle">
			<h1>Home</h1>
		</div><!-- End Page Title -->

		<section class="section dashboard">
			<div class="row">

				<!-- Left side columns -->
				<div class="col-lg-8">
					<div class="row" id="topic-tbody" th:if="${@collectionUtil.isNotEmpty(topicsList)}">

						<div class="col-lg-12">
							<!-- Card with an image on top -->
							<div class="card" th:each="topics : ${topicsList}">
								<div th:each="imageUrl : ${@storageService.getImageUrlsByPostId(topics.id)}">
									<img th:src="${imageUrl}" class="card-img-top" alt="ポスト画像">
								</div>
								<div class="card-body">
									<!-- 投稿者情報と投稿日時を横並び -->
									<div class="d-flex justify-content-between align-items-center mb-2">
										<div class="d-flex align-items-center">
											<img th:src="${topics.users.iconUri != null} ? ${@storageService.getDataUri(topics.users.iconUri)} : '/assets/img/profile-dummy.png'"
												alt="Profile" class="rounded-circle mt-2"
												style="height: 60px; width: 60px; object-fit: cover;">
											<a class="ms-2 fw-bold"
												th:href="@{/profile/view/{id}(id=${topics.users.id})}"
												th:text="${topics.users.name}">投稿者名</a>
											<!-- この名前の横にいいねボタンを入れます -->
											<form th:action="@{/topic/like/{id}(id=${topics.id})}" method="post"
												style="display: inline;">
												<input type="hidden" name="from" value="home" />
												<button type="submit" class="btn btn-outline-primary btn-lg ms-4">
													<i class="bi bi-hand-thumbs-up"></i>
													<span th:text="${@likesService.countLikes(topics.id)}">0</span>
												</button>
											</form>
										</div>
										<div class="text-muted" style="font-size: 0.8rem;"
											th:text="${#dates.format(topics.created, 'yyyy-MM-dd HH:mm')}">
											2025-05-09 14:00
										</div>
									</div>

									<h5 class="card-title" th:text="${topics.title}">タイトル</h5>
									<span th:utext="${@stringUtil.nl2br(topics.body)}"></span>

								</div>

								<div class="card-body">
									<div th:if="${validationErrors != null}"
										class="alert alert-danger alert-dismissible fade show" role="alert">
										<div th:each="error : ${validationErrors.getAllErrors()}">
											<i class="bi bi-exclamation-octagon me-1"></i>
											<span th:text="${error.getDefaultMessage()}">エラーメッセージ</span>
										</div>
										<button type="button" class="btn-close" data-bs-dismiss="alert"
											aria-label="Close"></button>
									</div>

									<!-- General Form Elements -->
									<form method="post" th:action="@{/topic/comment/regist/{id}(id=${topics.id})}"
										th:object="${requestTopicComment}" class="row g-3">
										<div class="col-md-12">
											<textarea class="form-control" th:field="*{body}"
												placeholder="コメントを入力..."></textarea>
										</div>
										<input type="hidden" name="from" value="home" />
										<div class="text-center">
											<button type="submit" class="btn btn-primary">コメントする</button>
										</div>
									</form><!-- End General Form Elements -->
								</div>

								<div th:each="comments : ${topics.commentsList}">
									<div class="card-body">
										<!-- アイコン・名前・日時 -->
										<div class="d-flex justify-content-between align-items-center mb-2">
											<div class="d-flex align-items-center">
												<img th:src="@{${comments.users.iconUri != null && comments.users.iconUri != '' ? comments.users.iconUri : '/assets/img/profile-dummy.png'}}"
													alt="Profile" class="rounded-circle mt-2"
													style="height: 80px; width: 80px; object-fit: cover;">
												<a class="ms-4 fw-bold " style="margin-top: -16px;"
													th:href="@{/profile/view/{id}(id=${comments.users.id})}"
													th:text="${comments.users.name}">コメント者名</a>
											</div>
										</div>
										<!-- コメント本文 -->
										<p class="mb-0"
											style="margin-left: 82px; margin-top: -46px; padding-left: 20px;"
											th:utext="${@stringUtil.nl2br(comments.body)}">
											コメント本文</p>
									</div>
								</div>
							</div>



							<div id="template" class="card p-0" style="display: none;">
								<!-- 投稿画像を表示する場所 -->
								<div class="card-img-top" data-id="topic-images"></div>

								<!-- 投稿本文 -->
								<div class="card-body template-post">
									<div class="d-flex justify-content-between align-items-center mb-2">
										<div class="d-flex align-items-center">
											<img data-id="icon" alt="Profile" style="height: 60px; width: 60px; object-fit: cover;"
											class="rounded-circle mt-2"
												src="/assets/img/profile-dummy.png">
											<a class="ms-2 fw-bold" data-id="topic-user-name" href="#">ユーザー名</a>
											<!-- この名前の横にいいねボタンを入れます -->
										</div>
										<div class="text-muted" style="font-size: 0.8rem;" data-id="topic-created">日時
										</div>
									</div>

									<h5 class="card-title" data-id="topic-title">タイトル</h5>
									<span data-id="topic-body">本文</span>
								</div>

								<!-- コメントフォーム -->
								<div class="card-body">
									<form method="post" class="row g-3 comment-form">
										<div class="col-md-12">
											<textarea class="form-control" name="body"
												placeholder="コメントを入力..."></textarea>
										</div>
										<div class="text-center">
											<button type="submit" class="btn btn-primary">コメントする</button>
										</div>
									</form>
								</div>

								<div class="card-body comment-list" data-id="comment-list">
									<!-- JavaScriptでここにコメントが追加される -->
								</div>

							</div>
						</div>
					</div>

					<div id="btn-more-section" th:if="${pager.totalElements > 5}" class="d-grid gap-2 mt-3">
						<button id="btn-more" class="btn btn-primary" type="button" onclick="callWebAPI();"
							th:data-sinceid="${pager.content[pager.content.size() - 1].id}">
							もっと見る
						</button>
					</div>
					<!-- Table with stripped rows -->
					<div th:if="${@collectionUtil.isEmpty(topicsList)}"
						class="alert alert-warning alert-dismissible fade show" role="alert">
						<i class="bi bi-exclamation-triangle me-1"></i>
						まだ投稿されていません。
					</div>
					<!-- End Table with stripped rows -->
				</div>




				<!-- Right side columns -->
				<div class="col-lg-4">

					<div class="card">
						<div class="card-body">
							<h5 class="card-title">今の気持ちをシェアしよう！</h5>

							<!-- Vertical Form -->
							<form class="row g-3" action="/topic/regist" method="POST" enctype="multipart/form-data">
								<div class="col-12">
									<label for="inputNanme4" class="form-label">タイトル</label>
									<input type="text" class="form-control" id="title" name="title" required>
								</div>

								<div class="col-12">
									<label for="inputNanme4" class="form-label">本文</label>
									<textarea class="form-control" style="height: 100px" id="body" name="body"
										required></textarea>
								</div>

								<div class="col-12">
									<label for="inputNanme4" class="form-label">写真</label>
									<input class="form-control" type="file" id="formFile" name="imageFiles" multiple>
								</div>

								<div class="text-center">
									<button type="submit" class="btn btn-primary">投稿する</button>
								</div>
							</form><!-- Vertical Form -->
						</div>
					</div>

					<!-- News & Updates Traffic -->
					<div class="card">

						<div class="card-body">
							<h5 class="card-title">ニュース</h5>

							<div class="news">
								<div class="post-item clearfix">
									<img src="/assets/img/news-1.jpg" alt="">
									<h4><a href="users-profile.jsp">今週ランチです。</a></h4>
									<p>ハヤシライス、ピリ辛味噌バターコーンのスープパスタを食べてきました。...</p>
								</div>

								<div class="post-item clearfix">
									<img src="/assets/img/news-2.jpg" alt="">
									<h4><a href="users-profile.jsp">様々なカクテルに秘められたストーリーをチェック</a></h4>
									<p>ハイビスカス香るまろやかなホットカクテルで、冬の寒さをくつろぎながら乗り切りましょう！...</p>
								</div>

								<div class="post-item clearfix">
									<img src="/assets/img/news-3.jpg" alt="">
									<h4><a href="users-profile.jsp">【MEN】HOW TO FIND THE BEST SUIT for FRESHERS
											CAMPAIGN</a></h4>
									<p>新しい季節を迎え、新しい門出を迎えるお客様へポール・スチュアートの特別なメニューをご用意しました。...</p>
								</div>

								<div class="post-item clearfix">
									<img src="/assets/img/news-4.jpg" alt="">
									<h4><a href="users-profile.jsp">20歳から続けていたトライアスロンを、仕事に集中するため一時的にやめてみたら</a></h4>
									<p>トライアスロンの練習は疲労をもたらします。でも習慣にしている練習をやめてしまうと、もっと体が疲労するというのです。...</p>
								</div>

								<div class="post-item clearfix">
									<img src="/assets/img/news-5.jpg" alt="">
									<h4><a href="users-profile.jsp">こんにちは！</a></h4>
									<p>東京は、日中は日差しが出て少し気温が上がったように感じます...</p>
								</div>

							</div><!-- End sidebar recent posts-->

						</div>
					</div><!-- End News & Updates -->

				</div><!-- End Right side columns -->

			</div>
		</section>

	</main><!-- End #main -->

	<!-- ======= Footer ======= -->
	<div th:replace="~{common/shoulder_fragment::footer}"></div>
	<script src="/assets/js/home.js"></script>

</body>
</head>

</html>